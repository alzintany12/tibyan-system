<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Client;
use App\Models\CaseModel;
use App\Models\Hearing;
use App\Models\Invoice;
use App\Models\User;
use Carbon\Carbon;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        // ğŸ§± Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Seeders Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­
        $this->call([
            RoleAndPermissionSeeder::class,  // Ø£ÙˆÙ„Ø§Ù‹: Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            UserSeeder::class,               // Ø«Ø§Ù†ÙŠØ§Ù‹: Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
            ClientSeeder::class,
            DocumentTemplatesSeeder::class,
        ]);

        // ğŸ§â€â™‚ï¸ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ (Ø§Ù„Ø£ÙˆÙ„)
        $admin = User::first();
        $adminId = $admin ? $admin->id : 1;

        // âš–ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø¶Ø§ÙŠØ§ ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        $this->createSampleCases($adminId);
    }

    private function createSampleCases($adminId)
    {
        // ğŸ§¾ Ø¬Ù„Ø¨ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        $clients = Client::take(3)->get();

        if ($clients->isEmpty()) {
            $clients = collect([
                Client::create([
                    'name' => 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ',
                    'national_id' => '1234567890',
                    'phone' => '0501234567',
                    'email' => 'ahmed@example.com',
                    'address' => 'Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø­ÙŠ Ø§Ù„Ù†Ø®ÙŠÙ„',
                    'created_by' => $adminId,
                ]),
                Client::create([
                    'name' => 'ÙØ§Ø·Ù…Ø© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø³Ø¹Ø¯',
                    'national_id' => '0987654321',
                    'phone' => '0509876543',
                    'email' => 'fatima@example.com',
                    'address' => 'Ø¬Ø¯Ø©ØŒ Ø­ÙŠ Ø§Ù„Ø±ÙˆØ¶Ø©',
                    'created_by' => $adminId,
                ]),
                Client::create([
                    'name' => 'Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©',
                    'national_id' => '1122334455',
                    'phone' => '0501122334',
                    'email' => 'info@tech.com',
                    'address' => 'Ø§Ù„Ø¯Ù…Ø§Ù…ØŒ Ø§Ù„Ø­ÙŠ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ',
                    'created_by' => $adminId,
                ]),
            ]);
        }

        // âš–ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§
        $casesData = [
            [
                'case_number' => 'CASE-2024-0001',
                'case_title' => 'Ù†Ø²Ø§Ø¹ Ù…Ù„ÙƒÙŠØ© Ø¹Ù‚Ø§Ø±ÙŠØ©',
                'case_summary' => 'Ù‚Ø¶ÙŠØ© Ø¹Ù‚Ø§Ø±ÙŠØ© ØªØªØ¹Ù„Ù‚ Ø¨Ù†Ø²Ø§Ø¹ Ù…Ù„ÙƒÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø­ÙˆÙ„ Ù‚Ø·Ø¹Ø© Ø£Ø±Ø¶ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶',
                'case_type' => 'real_estate',
                'status' => 'active',
                'priority' => 'high',
                'fees_received' => 15000.00,
                'fees_pending' => 5000.00,
                'total_fees' => 20000.00,
                'court_name' => 'Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ø§Ù„Ø±ÙŠØ§Ø¶',
                'court_type' => 'general',
                'opposing_party' => 'Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ù…Ù„Ø§Ùƒ Ø§Ù„Ù…ØªØ­Ø¯Ø©',
                'start_date' => Carbon::now()->subDays(30),
                'expected_end_date' => Carbon::now()->addDays(90),
                'next_hearing_date' => Carbon::now()->addDays(14),
                'next_hearing_time' => '10:30:00',
                'fee_type' => 'fixed',
                'case_value' => 500000.00,
                'is_active' => true,
            ],
            [
                'case_number' => 'CASE-2024-0002',
                'case_title' => 'Ù‚Ø¶ÙŠØ© Ù†ÙÙ‚Ø© ÙˆØ­Ø¶Ø§Ù†Ø©',
                'case_summary' => 'Ù‚Ø¶ÙŠØ© Ø£Ø­ÙˆØ§Ù„ Ø´Ø®ØµÙŠØ© ØªØªØ¹Ù„Ù‚ Ø¨Ø·Ù„Ø¨ Ù†ÙÙ‚Ø© ÙˆØ­Ø¶Ø§Ù†Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„',
                'case_type' => 'family',
                'status' => 'active',
                'priority' => 'medium',
                'fees_received' => 8000.00,
                'fees_pending' => 2000.00,
                'total_fees' => 10000.00,
                'court_name' => 'Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø­ÙˆØ§Ù„ Ø§Ù„Ø´Ø®ØµÙŠØ©',
                'court_type' => 'family',
                'opposing_party' => 'Ø®Ø§Ù„Ø¯ Ø£Ø­Ù…Ø¯ Ø§Ù„Ù†ÙˆØ±ÙŠ',
                'start_date' => Carbon::now()->subDays(15),
                'expected_end_date' => Carbon::now()->addDays(60),
                'next_hearing_date' => Carbon::now()->addDays(7),
                'next_hearing_time' => '09:00:00',
                'fee_type' => 'fixed',
                'case_value' => 50000.00,
                'is_active' => true,
            ],
            [
                'case_number' => 'CASE-2024-0003',
                'case_title' => 'Ù†Ø²Ø§Ø¹ ØªØ¬Ø§Ø±ÙŠ - Ø¹Ù‚Ø¯ ØªÙˆØ±ÙŠØ¯',
                'case_summary' => 'Ù†Ø²Ø§Ø¹ ØªØ¬Ø§Ø±ÙŠ Ø­ÙˆÙ„ Ø¹Ù‚Ø¯ ØªÙˆØ±ÙŠØ¯ Ù…Ø¹Ø¯Ø§Øª ØªÙ‚Ù†ÙŠØ© Ù…Ø¹ Ø´Ø±ÙƒØ© Ù…Ù†Ø§ÙØ³Ø©',
                'case_type' => 'commercial',
                'status' => 'completed',
                'priority' => 'low',
                'fees_received' => 25000.00,
                'fees_pending' => 0.00,
                'total_fees' => 25000.00,
                'court_name' => 'Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©',
                'court_type' => 'commercial',
                'opposing_party' => 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ©',
                'start_date' => Carbon::now()->subDays(120),
                'expected_end_date' => Carbon::now()->subDays(30),
                'actual_end_date' => Carbon::now()->subDays(30),
                'fee_type' => 'percentage',
                'fee_percentage' => 10.00,
                'case_value' => 250000.00,
                'result' => 'ØªÙ… Ø§Ù„Ø­ÙƒÙ… Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…ÙˆÙƒÙ„ Ø¨Ø§Ù„ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨',
                'is_active' => false,
            ],
        ];

        // â³ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ + Ø§Ù„Ø¬Ù„Ø³Ø§Øª + Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        foreach ($casesData as $index => $caseData) {
            $client = $clients[$index];

            $caseData['client_id'] = $client->id;
            $caseData['client_name'] = $client->name;
            $caseData['client_phone'] = $client->phone;
            $caseData['created_by'] = $adminId;
            $caseData['user_id'] = $adminId;

            $case = CaseModel::create($caseData);

            $this->createHearingsForCase($case, $adminId);
            $this->createInvoicesForCase($case, $client, $adminId);
        }
    }

    private function createHearingsForCase($case, $adminId)
    {
        $hearings = [];

        if ($case->status === 'active') {
            // Ø¬Ù„Ø³Ø© Ù…Ø§Ø¶ÙŠØ© Ù…ÙƒØªÙ…Ù„Ø©
            $hearings[] = [
                'case_id' => $case->id,
                'hearing_date' => Carbon::now()->subDays(7),
                'hearing_time' => '09:00:00',
                'title' => 'Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰',
                'description' => 'Ø¬Ù„Ø³Ø© Ø§ÙØªØªØ§Ø­ÙŠØ© Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹ÙˆÙ‰',
                'court_name' => $case->court_name,
                'court_room' => 'Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰',
                'hearing_type' => 'initial',
                'status' => 'completed',
                'result' => 'ØªÙ… ØªØ£Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ø­ÙŠÙ† Ø¥Ø­Ø¶Ø§Ø± Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©',
                'notes' => 'ØªÙ… Ø§Ù„ØªØ£Ø¬ÙŠÙ„ Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©',
                'completed_at' => Carbon::now()->subDays(7)->addHours(2),
                'created_by' => $adminId,
            ];

            // Ø¬Ù„Ø³Ø© Ù‚Ø§Ø¯Ù…Ø©
            $hearings[] = [
                'case_id' => $case->id,
                'hearing_date' => $case->next_hearing_date,
                'hearing_time' => $case->next_hearing_time,
                'title' => 'Ø¬Ù„Ø³Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©',
                'description' => 'Ø¬Ù„Ø³Ø© Ù„Ù„Ù†Ø¸Ø± ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©',
                'court_name' => $case->court_name,
                'court_room' => 'Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
                'hearing_type' => 'evidence',
                'status' => 'scheduled',
                'notes' => 'ÙŠØ±Ø¬Ù‰ Ø¥Ø­Ø¶Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©',
                'created_by' => $adminId,
            ];
        } else {
            // Ø¬Ù„Ø³Ø© Ø®ØªØ§Ù…ÙŠØ© Ù„Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
            $hearings[] = [
                'case_id' => $case->id,
                'hearing_date' => Carbon::now()->subDays(45),
                'hearing_time' => '11:00:00',
                'title' => 'Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø®ØªØ§Ù…ÙŠØ©',
                'description' => 'Ø¬Ù„Ø³Ø© Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ',
                'court_name' => $case->court_name,
                'court_room' => 'Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
                'hearing_type' => 'judgment',
                'status' => 'completed',
                'result' => 'ØµØ¯Ø± Ø§Ù„Ø­ÙƒÙ… Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…ÙˆÙƒÙ„',
                'notes' => 'ØµØ¯Ø± Ø§Ù„Ø­ÙƒÙ… Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…ÙˆÙƒÙ„ Ø¨ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø©',
                'completed_at' => Carbon::now()->subDays(45)->addHours(2),
                'created_by' => $adminId,
            ];
        }

        foreach ($hearings as $hearingData) {
            Hearing::create($hearingData);
        }
    }

    private function createInvoicesForCase($case, $client, $adminId)
    {
        // ğŸ’° ÙØ§ØªÙˆØ±Ø© Ù…Ø¯ÙÙˆØ¹Ø© Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ„Ù…
        if ($case->fees_received > 0) {
            $invoice1 = Invoice::create([
                'invoice_number' => 'INV-2024-' . str_pad($case->id * 2 - 1, 4, '0', STR_PAD_LEFT),
                'case_id' => $case->id,
                'client_name' => $client->name,
                'invoice_date' => $case->start_date,
                'due_date' => $case->start_date->copy()->addDays(30),
                'description' => "Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø£ØªØ¹Ø§Ø¨ Ù‚Ø¶ÙŠØ©: {$case->case_number}",
                'amount' => $case->fees_received,
                'tax_amount' => $case->fees_received * 0.15,
                'total_amount' => $case->fees_received * 1.15,
                'paid_amount' => $case->fees_received * 1.15,
                'status' => 'paid',
                'paid_at' => $case->start_date->copy()->addDays(5),
                'created_by' => 'Ø§Ù„Ù†Ø¸Ø§Ù…',
            ]);

            $invoice1->items()->create([
                'description' => 'Ø£ØªØ¹Ø§Ø¨ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© - Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰',
                'quantity' => 1,
                'unit_price' => $case->fees_received,
                'total_price' => $case->fees_received,
            ]);
        }

        // ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
        if ($case->fees_pending > 0) {
            $invoice2 = Invoice::create([
                'invoice_number' => 'INV-2024-' . str_pad($case->id * 2, 4, '0', STR_PAD_LEFT),
                'case_id' => $case->id,
                'client_name' => $client->name,
                'invoice_date' => Carbon::now()->subDays(10),
                'due_date' => Carbon::now()->addDays(20),
                'description' => "Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø£ØªØ¹Ø§Ø¨ Ù‚Ø¶ÙŠØ©: {$case->case_number}",
                'amount' => $case->fees_pending,
                'tax_amount' => $case->fees_pending * 0.15,
                'total_amount' => $case->fees_pending * 1.15,
                'paid_amount' => 0,
                'status' => 'pending',
                'sent_at' => Carbon::now()->subDays(10),
                'created_by' => 'Ø§Ù„Ù†Ø¸Ø§Ù…',
            ]);

            $invoice2->items()->create([
                'description' => 'Ø£ØªØ¹Ø§Ø¨ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© - Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©',
                'quantity' => 1,
                'unit_price' => $case->fees_pending,
                'total_price' => $case->fees_pending,
            ]);
        }
    }
}
